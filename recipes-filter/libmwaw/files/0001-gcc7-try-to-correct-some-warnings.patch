From d64c828a70514147622fab3049ffad93449e7750 Mon Sep 17 00:00:00 2001
From: osnola <alonso@loria.fr>
Date: Sun, 2 Jul 2017 10:03:30 +0200
Subject: [PATCH 1/2] gcc7: try to correct some warnings...

---
 autogen.sh                           |  2 +-
 src/lib/BeagleWksDBParser.cxx        |  1 +
 src/lib/ClarisDrawText.cxx           |  3 ++-
 src/lib/ClarisWksText.cxx            |  3 ++-
 src/lib/HanMacWrdJParser.cxx         |  4 ++--
 src/lib/HanMacWrdKGraph.cxx          |  1 +
 src/lib/HanMacWrdKParser.cxx         |  5 +++--
 src/lib/MWAWCell.cxx                 |  2 ++
 src/lib/MWAWChart.cxx                |  1 +
 src/lib/MWAWGraphicListener.cxx      |  4 ++--
 src/lib/MWAWGraphicShape.cxx         |  2 +-
 src/lib/MWAWPageSpan.cxx             |  1 +
 src/lib/MWAWPresentationListener.cxx |  4 ++--
 src/lib/MWAWSpreadsheetListener.cxx  |  8 ++++----
 src/lib/MWAWTextListener.cxx         | 10 +++++-----
 src/lib/MacDraft5Parser.cxx          |  2 +-
 src/lib/MacDrawProParser.cxx         |  4 ++--
 src/lib/MacDrawProStyleManager.cxx   |  4 ++--
 src/lib/MarinerWrtGraph.cxx          |  3 ++-
 src/lib/MarinerWrtText.cxx           |  2 +-
 src/lib/MoreText.cxx                 |  1 +
 src/lib/MsWksDBParser.cxx            |  1 +
 src/lib/MsWksGraph.cxx               |  5 +++--
 src/lib/MsWksSSParser.cxx            |  1 +
 src/lib/PowerPoint1Parser.cxx        |  2 +-
 src/lib/PowerPoint3Parser.cxx        |  2 +-
 src/lib/RagTime5Graph.cxx            |  2 +-
 src/lib/RagTime5Parser.cxx           |  2 +-
 src/lib/RagTimeSpreadsheet.cxx       |  8 ++++----
 src/lib/WriterPlsParser.cxx          |  2 +-
 src/lib/ZWrtText.cxx                 |  1 +
 src/lib/libmwaw_internal.cxx         |  7 +++++--
 src/lib/libmwaw_internal.hxx         | 15 +++++++++++++++
 33 files changed, 74 insertions(+), 41 deletions(-)

diff --git a/autogen.sh b/autogen.sh
index aededbc..3182b42 100755
--- a/autogen.sh
+++ b/autogen.sh
@@ -21,7 +21,7 @@ for i in $TESTLIBTOOLIZE; do
 done
 
 if [ "$LIBTOOLIZEFOUND" = "0" ]; then
-	echo "$0: need libtoolize tool to build lilbmwaw" >&2
+	echo "$0: need libtoolize tool to build libmwaw" >&2
 	exit 1
 fi
 
diff --git a/src/lib/BeagleWksDBParser.cxx b/src/lib/BeagleWksDBParser.cxx
index 3e6ce53..efaf283 100644
--- a/src/lib/BeagleWksDBParser.cxx
+++ b/src/lib/BeagleWksDBParser.cxx
@@ -1009,6 +1009,7 @@ bool BeagleWksDBParser::readRow()
         if (fSz>20) break;
         val=static_cast<int>(input->readULong(2));
         if (val) f << "g0=" << std::hex << val << std::dec << ",";
+        FALLTHROUGH;
       case BeagleWksDBParserInternal::Cell::Memo: // memoId
       case BeagleWksDBParserInternal::Cell::Picture: // pictId
       case BeagleWksDBParserInternal::Cell::Number:
diff --git a/src/lib/ClarisDrawText.cxx b/src/lib/ClarisDrawText.cxx
index aef88d4..f032414 100644
--- a/src/lib/ClarisDrawText.cxx
+++ b/src/lib/ClarisDrawText.cxx
@@ -520,7 +520,7 @@ shared_ptr<ClarisWksStruct::DSET> ClarisDrawText::readDSETZone(ClarisWksStruct::
       textZone->m_position = ClarisWksStruct::DSET::P_Main;
       break;
     }
-  // fail through intended
+    FALLTHROUGH;
   default:
     MWAW_DEBUG_MSG(("ClarisDrawText::readDSETZone: find unknown position %d\n", (textZone->m_textType >> 4)));
     f << "#position="<< (textZone->m_textType >> 4) << ",";
@@ -1358,6 +1358,7 @@ bool ClarisDrawText::sendText(ClarisDrawTextInternal::DSET const &zone, int subZ
         }
         MWAW_DEBUG_MSG(("ClarisDrawText::sendText: Find unexpected char 1\n"));
         f << "###";
+        FALLTHROUGH;
       case 0xb: // page break
         MWAW_DEBUG_MSG(("ClarisDrawText::sendText: Find unexpected page break\n"));
         f << "###pb";
diff --git a/src/lib/ClarisWksText.cxx b/src/lib/ClarisWksText.cxx
index 6b3eb0b..41bf87d 100644
--- a/src/lib/ClarisWksText.cxx
+++ b/src/lib/ClarisWksText.cxx
@@ -754,7 +754,7 @@ shared_ptr<ClarisWksStruct::DSET> ClarisWksText::readDSETZone(ClarisWksStruct::D
       textZone->m_position = ClarisWksStruct::DSET::P_Main;
       break;
     }
-  // fail through intended
+    FALLTHROUGH;
   default:
     MWAW_DEBUG_MSG(("ClarisWksText::readDSETZone: find unknown position %d\n", (textZone->m_textType >> 4)));
     f << "#position="<< (textZone->m_textType >> 4) << ",";
@@ -1788,6 +1788,7 @@ bool ClarisWksText::sendText(ClarisWksTextInternal::Zone const &zone, MWAWListen
         }
         MWAW_DEBUG_MSG(("ClarisWksText::sendText: Find unexpected char 1\n"));
         f << "###";
+        FALLTHROUGH;
       case 0xb: // page break
         numSectionInPage = 0;
         if (main)
diff --git a/src/lib/HanMacWrdJParser.cxx b/src/lib/HanMacWrdJParser.cxx
index 166125f..2f7680d 100644
--- a/src/lib/HanMacWrdJParser.cxx
+++ b/src/lib/HanMacWrdJParser.cxx
@@ -650,8 +650,8 @@ bool HanMacWrdJParser::readPrintInfo(MWAWEntry const &entry)
   MWAWVec2i paperSize = info.paper().size();
   MWAWVec2i pageSize = info.page().size();
 
-  bool useDocInfo = (dim[3]-dim[1]>margins[2]+margins[0]) &&
-                    (dim[2]-dim[0]>margins[2]+margins[0]);
+  bool useDocInfo = (float(dim[3]-dim[1])>margins[2]+margins[0]) &&
+                    (float(dim[2]-dim[0])>margins[3]+margins[1]);
   bool usePrintInfo = pageSize.x() > 0 && pageSize.y() > 0 &&
                       paperSize.x() > 0 && paperSize.y() > 0;
 
diff --git a/src/lib/HanMacWrdKGraph.cxx b/src/lib/HanMacWrdKGraph.cxx
index fa4b07d..fe4a3e2 100644
--- a/src/lib/HanMacWrdKGraph.cxx
+++ b/src/lib/HanMacWrdKGraph.cxx
@@ -1260,6 +1260,7 @@ bool HanMacWrdKGraph::sendFrame(HanMacWrdKGraphInternal::Frame const &frame, MWA
         return true;
       }
     }
+    FALLTHROUGH;
   case 10:
     return sendTextBox(static_cast<HanMacWrdKGraphInternal::TextBox const &>(frame), pos);
   case 6: {
diff --git a/src/lib/HanMacWrdKParser.cxx b/src/lib/HanMacWrdKParser.cxx
index 18239f1..ef9bd88 100644
--- a/src/lib/HanMacWrdKParser.cxx
+++ b/src/lib/HanMacWrdKParser.cxx
@@ -507,6 +507,7 @@ bool HanMacWrdKParser::readZone(shared_ptr<HanMacWrdKZone> zone)
   case 0xc:
     if (readZonec(zone))
       return true;
+    FALLTHROUGH;
   case 0xd:
     if (m_graphParser->readPicture(zone))
       return true;
@@ -586,8 +587,8 @@ bool HanMacWrdKParser::readPrintInfo(HanMacWrdKZone &zone)
   MWAWVec2i paperSize = info.paper().size();
   MWAWVec2i pageSize = info.page().size();
 
-  bool useDocInfo = (dim[3]-dim[1]>margins[2]+margins[0]) &&
-                    (dim[2]-dim[0]>margins[2]+margins[0]);
+  bool useDocInfo = (float(dim[3]-dim[1])>margins[2]+margins[0]) &&
+                    (float(dim[2]-dim[0])>margins[3]+margins[1]);
   bool usePrintInfo = pageSize.x() > 0 && pageSize.y() > 0 &&
                       paperSize.x() > 0 && paperSize.y() > 0;
 
diff --git a/src/lib/MWAWCell.cxx b/src/lib/MWAWCell.cxx
index f1c5a3e..645ab18 100644
--- a/src/lib/MWAWCell.cxx
+++ b/src/lib/MWAWCell.cxx
@@ -641,6 +641,8 @@ bool MWAWCellContent::double2String(double val, MWAWCell::Format const &format,
     time.tm_zone=0;
 #endif
     char buf[256];
+#pragma GCC diagnostic ignored "-Wformat-y2k"
+#pragma GCC diagnostic ignored "-Wformat-nonliteral"
     if (mktime(&time)==-1 ||
         !strftime(buf, 256, format.m_DTFormat.empty() ? "%m/%d/%y" : format.m_DTFormat.c_str(), &time))
       return false;
diff --git a/src/lib/MWAWChart.cxx b/src/lib/MWAWChart.cxx
index 3ca98bd..c9b6e6d 100644
--- a/src/lib/MWAWChart.cxx
+++ b/src/lib/MWAWChart.cxx
@@ -624,6 +624,7 @@ std::ostream &operator<<(std::ostream &o, MWAWChart::TextZone const &zone)
   switch (zone.m_type) {
   case MWAWChart::TextZone::T_SubTitle:
     o << "sub";
+    FALLTHROUGH;
   case MWAWChart::TextZone::T_Title:
     o << "title";
     if (zone.m_contentType==MWAWChart::TextZone::C_Cell)
diff --git a/src/lib/MWAWGraphicListener.cxx b/src/lib/MWAWGraphicListener.cxx
index da8e8e1..6b723e8 100644
--- a/src/lib/MWAWGraphicListener.cxx
+++ b/src/lib/MWAWGraphicListener.cxx
@@ -1480,7 +1480,7 @@ void MWAWGraphicListener::_handleFrameParameters(librevenge::RVNGPropertyList &l
     switch (pos.m_yPos) {
     case MWAWPosition::YFull:
       list.insert("svg:height", double(h), unit);
-    // fallthrough intended
+      FALLTHROUGH;
     case MWAWPosition::YTop:
       if (origin[1] < 0 || origin[1] > 0) {
         list.insert("style:vertical-pos", "from-top");
@@ -1522,7 +1522,7 @@ void MWAWGraphicListener::_handleFrameParameters(librevenge::RVNGPropertyList &l
     switch (pos.m_xPos) {
     case MWAWPosition::XFull:
       list.insert("svg:width", double(w), unit);
-    // fallthrough intended
+      FALLTHROUGH;
     case MWAWPosition::XLeft:
       if (origin[0] < 0 || origin[0] > 0) {
         list.insert("style:horizontal-pos", "from-left");
diff --git a/src/lib/MWAWGraphicShape.cxx b/src/lib/MWAWGraphicShape.cxx
index 22b3c55..f1e7418 100644
--- a/src/lib/MWAWGraphicShape.cxx
+++ b/src/lib/MWAWGraphicShape.cxx
@@ -596,7 +596,7 @@ std::vector<MWAWGraphicShape::PathData> MWAWGraphicShape::getPath(bool forTransf
   switch (m_type) {
   case Measure:
     MWAW_DEBUG_MSG(("MWAWGraphicShape::getPath: called on a measure, transform it in line\n"));
-  // fall through expected
+    FALLTHROUGH;
   case Line:
   case Polygon: {
     size_t n=m_vertices.size();
diff --git a/src/lib/MWAWPageSpan.cxx b/src/lib/MWAWPageSpan.cxx
index 79611cf..b1064c4 100644
--- a/src/lib/MWAWPageSpan.cxx
+++ b/src/lib/MWAWPageSpan.cxx
@@ -226,6 +226,7 @@ void MWAWPageSpan::setHeaderFooter(MWAWHeaderFooter const &hF)
   switch (hF.m_occurrence) {
   case MWAWHeaderFooter::NEVER:
     removeHeaderFooter(type, MWAWHeaderFooter::ALL);
+    FALLTHROUGH;
   case MWAWHeaderFooter::ALL:
     removeHeaderFooter(type, MWAWHeaderFooter::ODD);
     removeHeaderFooter(type, MWAWHeaderFooter::EVEN);
diff --git a/src/lib/MWAWPresentationListener.cxx b/src/lib/MWAWPresentationListener.cxx
index 705ca60..23542cd 100644
--- a/src/lib/MWAWPresentationListener.cxx
+++ b/src/lib/MWAWPresentationListener.cxx
@@ -1489,7 +1489,7 @@ void MWAWPresentationListener::_handleFrameParameters(librevenge::RVNGPropertyLi
     switch (pos.m_yPos) {
     case MWAWPosition::YFull:
       list.insert("svg:height", double(h), unit);
-    // fallthrough intended
+      FALLTHROUGH;
     case MWAWPosition::YTop:
       if (origin[1] < 0 || origin[1] > 0) {
         list.insert("style:vertical-pos", "from-top");
@@ -1531,7 +1531,7 @@ void MWAWPresentationListener::_handleFrameParameters(librevenge::RVNGPropertyLi
     switch (pos.m_xPos) {
     case MWAWPosition::XFull:
       list.insert("svg:width", double(w), unit);
-    // fallthrough intended
+      FALLTHROUGH;
     case MWAWPosition::XLeft:
       if (origin[0] < 0 || origin[0] > 0) {
         list.insert("style:horizontal-pos", "from-left");
diff --git a/src/lib/MWAWSpreadsheetListener.cxx b/src/lib/MWAWSpreadsheetListener.cxx
index c8c7592..f454fb8 100644
--- a/src/lib/MWAWSpreadsheetListener.cxx
+++ b/src/lib/MWAWSpreadsheetListener.cxx
@@ -1054,7 +1054,7 @@ void MWAWSpreadsheetListener::insertShape
   default:
 #endif
     MWAW_DEBUG_MSG(("MWAWSpreadsheetListener::insertShape: UNKNOWN position, insert as char position\n"));
-  // fallthrough intended
+    FALLTHROUGH;
   case MWAWPosition::CharBaseLine:
   case MWAWPosition::Char:
     if (m_ps->m_isSpanOpened)
@@ -1171,7 +1171,7 @@ bool MWAWSpreadsheetListener::openFrame(MWAWPosition const &pos, MWAWGraphicStyl
     break;
   case MWAWPosition::Unknown:
     MWAW_DEBUG_MSG(("MWAWSpreadsheetListener::openFrame: UNKNOWN position, insert as char position\n"));
-  // fallthrough intended
+    FALLTHROUGH;
   case MWAWPosition::CharBaseLine:
   case MWAWPosition::Char:
     if (m_ps->m_isSpanOpened)
@@ -1346,7 +1346,7 @@ void MWAWSpreadsheetListener::_handleFrameParameters
     switch (pos.m_yPos) {
     case MWAWPosition::YFull:
       propList.insert("svg:height", double(h), unit);
-    // fallthrough intended
+      FALLTHROUGH;
     case MWAWPosition::YTop:
       if (origin[1] < 0 || origin[1] > 0) {
         propList.insert("style:vertical-pos", "from-top");
@@ -1388,7 +1388,7 @@ void MWAWSpreadsheetListener::_handleFrameParameters
     switch (pos.m_xPos) {
     case MWAWPosition::XFull:
       propList.insert("svg:width", double(w), unit);
-    // fallthrough intended
+      FALLTHROUGH;
     case MWAWPosition::XLeft:
       if (origin[0] < 0 || origin[0] > 0) {
         propList.insert("style:horizontal-pos", "from-left");
diff --git a/src/lib/MWAWTextListener.cxx b/src/lib/MWAWTextListener.cxx
index 2294d1b..151f64a 100644
--- a/src/lib/MWAWTextListener.cxx
+++ b/src/lib/MWAWTextListener.cxx
@@ -1139,7 +1139,7 @@ void MWAWTextListener::insertShape
   default:
 #endif
     MWAW_DEBUG_MSG(("MWAWTextListener::insertShape: UNKNOWN position, insert as char position\n"));
-  // fallthrough intended
+    FALLTHROUGH;
   case MWAWPosition::CharBaseLine:
   case MWAWPosition::Char:
     if (m_ps->m_isSpanOpened)
@@ -1255,7 +1255,7 @@ bool MWAWTextListener::openFrame(MWAWPosition const &pos, MWAWGraphicStyle const
     break;
   case MWAWPosition::Unknown:
     MWAW_DEBUG_MSG(("MWAWTextListener::openFrame: UNKNOWN position, insert as char position\n"));
-  // fallthrough intended
+    FALLTHROUGH;
   case MWAWPosition::CharBaseLine:
   case MWAWPosition::Char:
     if (m_ps->m_isSpanOpened)
@@ -1339,7 +1339,7 @@ bool MWAWTextListener::openGroup(MWAWPosition const &pos)
   default:
 #endif
     MWAW_DEBUG_MSG(("MWAWTextListener::openGroup: UNKNOWN position, insert as char position\n"));
-  // fallthrough intended
+    FALLTHROUGH;
   case MWAWPosition::CharBaseLine:
   case MWAWPosition::Char:
     if (m_ps->m_isSpanOpened)
@@ -1490,7 +1490,7 @@ void MWAWTextListener::_handleFrameParameters
     switch (pos.m_yPos) {
     case MWAWPosition::YFull:
       propList.insert("svg:height", double(h), unit);
-    // fallthrough intended
+      FALLTHROUGH;
     case MWAWPosition::YTop:
       if (origin[1] < 0 || origin[1] > 0) {
         propList.insert("style:vertical-pos", "from-top");
@@ -1532,7 +1532,7 @@ void MWAWTextListener::_handleFrameParameters
     switch (pos.m_xPos) {
     case MWAWPosition::XFull:
       propList.insert("svg:width", double(w), unit);
-    // fallthrough intended
+      FALLTHROUGH;
     case MWAWPosition::XLeft:
       if (origin[0] < 0 || origin[0] > 0) {
         propList.insert("style:horizontal-pos", "from-left");
diff --git a/src/lib/MacDraft5Parser.cxx b/src/lib/MacDraft5Parser.cxx
index 2baeed9..6c11d41 100644
--- a/src/lib/MacDraft5Parser.cxx
+++ b/src/lib/MacDraft5Parser.cxx
@@ -1473,7 +1473,7 @@ bool MacDraft5Parser::readObject(MacDraft5ParserInternal::Layout &layout)
         shape->m_shape=MWAWGraphicShape::rectangle(MWAWBox2f(listPts[0], listPts[2]), corner);
         break;
       }
-    // fall through intended
+      FALLTHROUGH;
     case 0x3:
     case 0x4: {
       rotation=0;
diff --git a/src/lib/MacDrawProParser.cxx b/src/lib/MacDrawProParser.cxx
index e8b9b9b..91c70fa 100644
--- a/src/lib/MacDrawProParser.cxx
+++ b/src/lib/MacDrawProParser.cxx
@@ -1310,7 +1310,7 @@ int MacDrawProParser::readObject()
       f << "bitmap,";
       break;
     }
-  // fall through intended
+    FALLTHROUGH;
   default:
     MWAW_DEBUG_MSG(("MacDrawProParser::readObject: find unknown type %d\n", val));
     f << "###type=" << std::hex << val << std::dec << ",";
@@ -2230,7 +2230,7 @@ bool MacDrawProParser::readGeometryShapeData(MacDrawProParserInternal::Shape &sh
         shape.m_shape.m_path.push_back(MWAWGraphicShape::PathData('L', listVertices.back()));
       break;
     }
-  // fall through intended
+    FALLTHROUGH;
   case 9: { // spline
     if (remain<=2) {
       MWAW_DEBUG_MSG(("MacDrawProParser::readGeometryShapeData: can not read compute the number of point in spline\n"));
diff --git a/src/lib/MacDrawProStyleManager.cxx b/src/lib/MacDrawProStyleManager.cxx
index 88940ce..9fa242b 100644
--- a/src/lib/MacDrawProStyleManager.cxx
+++ b/src/lib/MacDrawProStyleManager.cxx
@@ -2442,7 +2442,7 @@ bool MacDrawProStyleManager::readGradientMap(MWAWEntry const &entry, int N, int
       break;
     case 1:
       gradient.m_type = MWAWGraphicStyle::G_Radial;
-    // fall through expected
+      FALLTHROUGH;
     case 2: {
       if (type==2) gradient.m_type = MWAWGraphicStyle::G_Rectangular;
       int dim[4]; // square which defined the center rectangle
@@ -2554,7 +2554,7 @@ bool MacDrawProStyleManager::readGradientPalette(MWAWEntry const &entry, int fie
       break;
     case 1:
       f << "concentric,";
-    // fall through expected
+      FALLTHROUGH;
     case 2: {
       if (type==2) f << "radial,";
       int dim[4]; // square which defined the center rectangle
diff --git a/src/lib/MarinerWrtGraph.cxx b/src/lib/MarinerWrtGraph.cxx
index 1444e0f..fc9ecd0 100644
--- a/src/lib/MarinerWrtGraph.cxx
+++ b/src/lib/MarinerWrtGraph.cxx
@@ -130,7 +130,7 @@ struct Token {
       switch (m_pictBorderType[i]) {
       case 1: // single[w=0.5]
         border.m_width = 0.5;
-      // fallthrough intended
+        FALLTHROUGH;
       case 2:
         border.m_style = MWAWBorder::Simple;
         break;
@@ -1024,6 +1024,7 @@ bool MarinerWrtGraph::readTokenBlock0(MarinerWrtStruct const &data, MarinerWrtGr
   case 0x18:
     val = input->readLong(2);
     if (val) f << "f0=" << val << ","; // fieldType?
+    FALLTHROUGH;
   case 0x19:
   case 0x1e:
   case 0x1f:
diff --git a/src/lib/MarinerWrtText.cxx b/src/lib/MarinerWrtText.cxx
index a65e033..6d2e097 100644
--- a/src/lib/MarinerWrtText.cxx
+++ b/src/lib/MarinerWrtText.cxx
@@ -235,7 +235,7 @@ MWAWBorder Paragraph::BorderFill::getBorder(int i) const
     break;
   case 1: // single[w=0.5]
     res.m_width = 0.5;
-  // fall-through intended
+    FALLTHROUGH;
   case 2:
     res.m_style = MWAWBorder::Simple;
     break;
diff --git a/src/lib/MoreText.cxx b/src/lib/MoreText.cxx
index 8410dbc..c70fc77 100644
--- a/src/lib/MoreText.cxx
+++ b/src/lib/MoreText.cxx
@@ -2050,6 +2050,7 @@ bool MoreText::readTabs(MWAWEntry const &entry, MoreTextInternal::Paragraph &par
       break;
     case 3: // more large space
       f2 << "dot[large],";
+      FALLTHROUGH;
     case 2:
       tab.m_leaderCharacter = '.';
       break;
diff --git a/src/lib/MsWksDBParser.cxx b/src/lib/MsWksDBParser.cxx
index 785162d..1e67458 100644
--- a/src/lib/MsWksDBParser.cxx
+++ b/src/lib/MsWksDBParser.cxx
@@ -1143,6 +1143,7 @@ bool MsWksDBParser::readFormTypes(MsWksDBParserInternal::Form &form)
         visible = MsWksDBParserInternal::V_HEADER;
         break;
       }
+      FALLTHROUGH;
     default:
       f << "##unkn[visible]=" << hiFlag << ",";
       break;
diff --git a/src/lib/MsWksGraph.cxx b/src/lib/MsWksGraph.cxx
index 9ffaf84..bb70d52 100644
--- a/src/lib/MsWksGraph.cxx
+++ b/src/lib/MsWksGraph.cxx
@@ -1227,6 +1227,7 @@ bool MsWksGraph::readPictHeader(MsWksGraphInternal::Zone &pict)
   switch (lineFlags&3) {
   case 2:
     style.m_arrows[0]=MWAWGraphicStyle::Arrow::plain();
+    FALLTHROUGH;
   case 1:
     style.m_arrows[1]=MWAWGraphicStyle::Arrow::plain();
     break;
@@ -1897,7 +1898,7 @@ void MsWksGraph::computePositions(int zoneId, std::vector<int> &linesH, std::vec
       h+=middleH;
       int p = 0;
       while (p < nPages) {
-        if (h < pagesH[size_t(p)]) break;
+        if (h < float(pagesH[size_t(p)])) break;
         h -= float(pagesH[size_t(p++)]);
       }
       zone->m_page = p;
@@ -1988,7 +1989,7 @@ bool MsWksGraph::readRB(MWAWInputStreamPtr input, MWAWEntry const &entry, int ki
   case 2:
     if (input->readLong(1)!=3) return false;
     f << "id=" << input->readLong(1) << ",";
-  // no jump expected
+    FALLTHROUGH;
   case 1: {
     unsigned long dSz=input->readULong(4);
     beginRB=input->tell();
diff --git a/src/lib/MsWksSSParser.cxx b/src/lib/MsWksSSParser.cxx
index 72efc00..271a5c7 100644
--- a/src/lib/MsWksSSParser.cxx
+++ b/src/lib/MsWksSSParser.cxx
@@ -933,6 +933,7 @@ bool MsWksSSParser::readCell(int sz, MWAWVec2i const &cellPos, MsWksSSParserInte
     break;
   case 3:
     f << "type" << type << ",";
+    FALLTHROUGH;
   case 2: //number general
     format.m_format=MWAWCell::F_NUMBER;
     content.m_contentType=MWAWCellContent::C_FORMULA;
diff --git a/src/lib/PowerPoint1Parser.cxx b/src/lib/PowerPoint1Parser.cxx
index d5ac56b..8796de0 100644
--- a/src/lib/PowerPoint1Parser.cxx
+++ b/src/lib/PowerPoint1Parser.cxx
@@ -2537,7 +2537,7 @@ bool PowerPoint1Parser::sendFrame(PowerPoint1ParserInternal::Frame const &frame,
     if (frame.m_type==0)
       shape=MWAWGraphicShape::line(fBox[0], fBox[1]);
     else {
-      if (frame.m_cornerSize >= fBox.size()[0] || frame.m_cornerSize >= fBox.size()[1])
+      if (float(frame.m_cornerSize) >= fBox.size()[0] || float(frame.m_cornerSize) >= fBox.size()[1])
         shape=MWAWGraphicShape::circle(fBox);
       else
         shape=MWAWGraphicShape::rectangle(fBox, MWAWVec2f(float(frame.m_cornerSize)/2.f, float(frame.m_cornerSize)/2.f));
diff --git a/src/lib/PowerPoint3Parser.cxx b/src/lib/PowerPoint3Parser.cxx
index da2c8eb..81b15f2 100644
--- a/src/lib/PowerPoint3Parser.cxx
+++ b/src/lib/PowerPoint3Parser.cxx
@@ -2952,7 +2952,7 @@ bool PowerPoint3Parser::readParagraph(MWAWParagraph &para, PowerPoint3ParserInte
         }
         val &= 0xbf;
       }
-    // fall through expected
+      FALLTHROUGH;
     default:
       if (val)
         f << std::hex << val << std::dec << ",";
diff --git a/src/lib/RagTime5Graph.cxx b/src/lib/RagTime5Graph.cxx
index 86da24a..4d0c838 100644
--- a/src/lib/RagTime5Graph.cxx
+++ b/src/lib/RagTime5Graph.cxx
@@ -665,7 +665,7 @@ bool RagTime5Graph::readColorPatternZone(RagTime5ClusterManager::Cluster &cluste
     RagTime5ClusterManager::Link const &lnk=cluster.m_linksList[i];
     shared_ptr<RagTime5Zone> data=m_mainParser.getDataZone(lnk.m_ids[0]);
     if (!data || !data->m_entry.valid()) {
-      if (lnk.m_N*lnk.m_fieldSize) {
+      if (lnk.m_N && lnk.m_fieldSize) {
         MWAW_DEBUG_MSG(("RagTime5Graph::readColorPatternZone: can not find data zone %d\n", lnk.m_ids[0]));
       }
       continue;
diff --git a/src/lib/RagTime5Parser.cxx b/src/lib/RagTime5Parser.cxx
index 08f13db..9af4803 100644
--- a/src/lib/RagTime5Parser.cxx
+++ b/src/lib/RagTime5Parser.cxx
@@ -1241,7 +1241,7 @@ bool RagTime5Parser::readClusterLinkList(RagTime5Zone &zone, RagTime5ClusterMana
 {
   listLinks.clear();
   if (!zone.m_entry.valid()) {
-    if (link.m_N*link.m_fieldSize) {
+    if (link.m_N && link.m_fieldSize) {
       MWAW_DEBUG_MSG(("RagTime5Parser::readClusterLinkList: can not find data zone %d\n", link.m_ids[0]));
     }
     return false;
diff --git a/src/lib/RagTimeSpreadsheet.cxx b/src/lib/RagTimeSpreadsheet.cxx
index c5bbbd3..2f22f2b 100644
--- a/src/lib/RagTimeSpreadsheet.cxx
+++ b/src/lib/RagTimeSpreadsheet.cxx
@@ -1415,9 +1415,9 @@ bool RagTimeSpreadsheet::readSpreadsheetCellContent(RagTimeSpreadsheetInternal::
     break;
   case 0x81:
     f << "float81,";
-  // fall through intended
+    FALLTHROUGH;
   case 3:
-  // fall through intended
+    FALLTHROUGH;
   case 1: {
     if (type==3) {
       format.m_format=MWAWCell::F_DATE; // we need the format to choose between date and time
@@ -1444,7 +1444,7 @@ bool RagTimeSpreadsheet::readSpreadsheetCellContent(RagTimeSpreadsheetInternal::
   }
   case 0x24:
     f << "text2,";
-  // fall through intended
+    FALLTHROUGH;
   case 4: {
     format.m_format=MWAWCell::F_TEXT;
     content.m_textEntry.setBegin(input->tell());
@@ -1483,7 +1483,7 @@ bool RagTimeSpreadsheet::readSpreadsheetCellContent(RagTimeSpreadsheetInternal::
   }
   case 0x51:
     f << "long51,";
-  // fall through intended
+    FALLTHROUGH;
   case 0x11: // or 2 int?
     if (pos+5>endPos) {
       ok=false;
diff --git a/src/lib/WriterPlsParser.cxx b/src/lib/WriterPlsParser.cxx
index 264006d..4568236 100644
--- a/src/lib/WriterPlsParser.cxx
+++ b/src/lib/WriterPlsParser.cxx
@@ -1084,7 +1084,7 @@ bool WriterPlsParser::sendWindow(int zone, MWAWVec2i limits)
             listener->insertBreak(MWAWTextListener::ColumnBreak);
           }
         }
-      // fall through intended
+        FALLTHROUGH;
       case 0:
       case 2:
         ok = readText(pInfo);
diff --git a/src/lib/ZWrtText.cxx b/src/lib/ZWrtText.cxx
index fce716d..ea26c05 100644
--- a/src/lib/ZWrtText.cxx
+++ b/src/lib/ZWrtText.cxx
@@ -791,6 +791,7 @@ bool ZWrtText::sendHeaderFooter(bool header)
           break;
       }
       input->seek(actPos+1, librevenge::RVNG_SEEK_SET);
+      FALLTHROUGH;
     default:
       listener->insertCharacter(static_cast<unsigned char>(c), input, endPos);
       break;
diff --git a/src/lib/libmwaw_internal.cxx b/src/lib/libmwaw_internal.cxx
index 6976def..f4d45f5 100644
--- a/src/lib/libmwaw_internal.cxx
+++ b/src/lib/libmwaw_internal.cxx
@@ -339,12 +339,14 @@ bool convertDTFormat(std::string const &dtFormat, librevenge::RVNGPropertyListVe
     switch (ch) {
     case 'Y':
       list.insert("number:style", "long");
+      FALLTHROUGH;
     case 'y':
       list.insert("librevenge:value-type", "year");
       propVect.append(list);
       break;
     case 'B':
       list.insert("number:style", "long");
+      FALLTHROUGH;
     case 'b':
     case 'h':
       list.insert("librevenge:value-type", "month");
@@ -357,13 +359,14 @@ bool convertDTFormat(std::string const &dtFormat, librevenge::RVNGPropertyListVe
       break;
     case 'e':
       list.insert("number:style", "long");
-    // fall-through intended
+      FALLTHROUGH;
     case 'd':
       list.insert("librevenge:value-type", "day");
       propVect.append(list);
       break;
     case 'A':
       list.insert("number:style", "long");
+      FALLTHROUGH;
     case 'a':
       list.insert("librevenge:value-type", "day-of-week");
       propVect.append(list);
@@ -371,7 +374,7 @@ bool convertDTFormat(std::string const &dtFormat, librevenge::RVNGPropertyListVe
 
     case 'H':
       list.insert("number:style", "long");
-    // fall-through intended
+      FALLTHROUGH;
     case 'I':
       list.insert("librevenge:value-type", "hours");
       propVect.append(list);
diff --git a/src/lib/libmwaw_internal.hxx b/src/lib/libmwaw_internal.hxx
index b63c4c8..317cbfa 100644
--- a/src/lib/libmwaw_internal.hxx
+++ b/src/lib/libmwaw_internal.hxx
@@ -116,6 +116,21 @@ struct MWAW_shared_ptr_noop_deleter {
 #  define LIBMWAW_ATTRIBUTE_PRINTF(fmt, arg)
 #endif
 
+#if defined(__clang__)
+#  if __has_cpp_attribute(clang::fallthrough)
+#    define FALLTHROUGH [[clang::fallthrough]]
+#  else
+#    define FALLTHROUGH
+#  endif
+#elif defined(__GNUC__)
+#  if __GNUC__>=7
+#    define FALLTHROUGH [[fallthrough]]
+#  else
+#    define FALLTHROUGH
+#  endif
+#else
+#  define FALLTHROUGH
+#endif
 /* ---------- debug  --------------- */
 #ifdef DEBUG
 namespace libmwaw
-- 
2.9.4

